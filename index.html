<!-- ‚úÇÔ∏è Only the edited/added parts shown for brevity -->

<!-- Inside <body> -->
<div class="section">
  <div class="section-title">Heaven's Vault Portfolio</div>
  <div id="heaven">Loading...</div>
</div>

<div class="section">
  <div class="section-title">üèÜ Winnings</div>
  <div id="winnings">¬£0.00</div>
</div>

<script>
  const START_STABLE = 5000;
  let startHeaven = 5000;
  let winnings = 0;

  const stableTokens = {
    'USDE': 'ethena-usde',
    'RAI': 'rai',
    'FRAX': 'frax',
    'ALUSD': 'alchemix-usd',
    'LUSD': 'liquity-usd'
  };

  const heavenTokens = {
    'ETHENA': 'ethena-usde',
    'PENDLE': 'pendle',
    'GMX': 'gmx',
    'LIT': 'litentry',
    'METH': 'mantle-staked-ether'
  };

  async function fetchPrices(tokens) {
    const ids = Object.values(tokens).join(',');
    const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=gbp`;

    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();
      if (!Object.keys(data).length) throw new Error("Empty price data");
      return data;
    } catch (err) {
      console.error("‚ùå Fetch error:", err);
      alert("Failed to load token prices from CoinGecko. Using fallback prices (¬£1.00).");
      return {};
    }
  }

  function calculate(tokens, prices, start, label) {
    const split = start / Object.keys(tokens).length;
    let total = 0;
    const html = [];

    for (const [symbol, id] of Object.entries(tokens)) {
      const price = prices[id]?.gbp ?? 1;
      const qty = split / price;
      const value = qty * price;
      total += value;
      html.push(`<div class="box">${symbol} Price<br>¬£${price.toFixed(6)}</div>`);
    }

    const gain = total - start;
    const gainClass = gain >= 0 ? 'positive' : 'negative';
    return {
      html: `
        <div class="box">Total Value<br>¬£${total.toFixed(2)}</div>
        ${html.join('')}
        <div class="gain ${gainClass}">Gain<br>¬£${gain.toFixed(2)}</div>
      `,
      total,
      gain
    };
  }

  async function updateVault() {
    const stablePrices = await fetchPrices(stableTokens);
    const heavenPrices = await fetchPrices(heavenTokens);

    const stableData = calculate(stableTokens, stablePrices, START_STABLE, "Stablecoin");
    const heavenData = calculate(heavenTokens, heavenPrices, startHeaven, "Heaven");

    // Auto-move profits if Heaven's Vault gain >= ¬£50
    if (heavenData.gain >= 50) {
      winnings += heavenData.gain;
      startHeaven = heavenData.total; // reset baseline to current
    }

    document.getElementById("stable").innerHTML = stableData.html;
    document.getElementById("heaven").innerHTML = heavenData.html;
    document.getElementById("winnings").innerHTML = `¬£${winnings.toFixed(2)}`;
    document.getElementById("timestamp").textContent = "Last updated: " + new Date().toUTCString();
  }

  document.addEventListener('DOMContentLoaded', () => {
    updateVault();
    setInterval(updateVault, 5000);
  });
</script>
