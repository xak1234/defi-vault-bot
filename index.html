<!DOCTYPE html>
<html>
<head>
  <title>üíº Daddy's Live DeFi Vault</title>
  <meta charset="UTF-8">
  <style>
    body {
      background: #0d0d0d;
      color: #00ffcc;
      font-family: monospace;
      padding: 20px;
    }
    h1 {
      color: #00ffff;
      font-size: 20px;
    }
    .timestamp {
      font-size: 12px;
      color: #aaa;
      margin-bottom: 20px;
    }
    .section {
      margin-bottom: 40px;
    }
    .section-title {
      font-size: 16px;
      font-weight: bold;
      color: #00ffff;
      margin-bottom: 10px;
    }
    .box {
      background: #111;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
      border: 1px solid #222;
    }
    .gain {
      font-weight: bold;
      color: #00ffcc;
      margin-top: 10px;
    }
    .positive {
      color: #00ff00;
    }
    .negative {
      color: #ff4444;
    }
  </style>
  <script>
    const START_STABLE = 5000;
    const START_HEAVEN = 5000;

    const stableTokens = {
      'USDE': 'ethena-usde',
      'RAI': 'rai',
      'FRAX': 'frax',
      'ALUSD': 'alchemix-usd',
      'LUSD': 'liquity-usd'
    };

    const heavenTokens = {
      'ETHENA': 'ethena-usde',
      'PENDLE': 'pendle',
      'GMX': 'gmx',
      'LIT': 'litentry',
      'METH': 'mantle-staked-ether'
    };

    async function fetchPrices(tokenMap) {
      const ids = [...new Set(Object.values(tokenMap))].join(',');
      const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=gbp`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Rate limit or network error");
      return res.json();
    }

    function calculatePortfolio(tokens, prices, startAmount) {
      const split = startAmount / Object.keys(tokens).length;
      let total = 0;
      const tokenHTML = [];

      for (const [symbol, id] of Object.entries(tokens)) {
        const price = prices[id]?.gbp ?? 1;
        const qty = split / price;
        const value = qty * price;
        total += value;

        tokenHTML.push(`
          <div class="box">${symbol} Price<br>¬£${price.toFixed(6)}</div>
        `);
      }

      const gain = total - startAmount;
      const gainClass = gain >= 0 ? 'positive' : 'negative';

      const output = `
        <div class="box">Total Value<br>¬£${total.toFixed(2)}</div>
        ${tokenHTML.join('')}
        <div class="gain ${gainClass}">Gain<br>¬£${gain.toFixed(2)} (${((gain / startAmount) * 100).toFixed(2)}%)</div>
      `;
      return output;
    }

    async function updateVault() {
      try {
        const allTokens = { ...stableTokens, ...heavenTokens };
        const prices = await fetchPrices(allTokens);

        const stableOutput = calculatePortfolio(stableTokens, prices, START_STABLE);
        const heavenOutput = calculatePortfolio(heavenTokens, prices, START_HEAVEN);

        document.getElementById("stable").innerHTML = stableOutput;
        document.getElementById("heaven").innerHTML = heavenOutput;
        document.getElementById("timestamp").textContent = "Last updated: " + new Date().toUTCString();
      } catch (err) {
        document.getElementById("stable").innerHTML = "<p style='color:red;'>‚ùå Failed to load data.</p>";
        document.getElementById("heaven").innerHTML = "";
        console.error(err);
      }
    }

    setInterval(updateVault, 300000); // Refresh every 5 minutes
    window.onload = updateVault;
  </script>
</head>
<body>
  <h1>üíº Daddy's Live DeFi Vault</h1>
  <div class="timestamp" id="timestamp">Loading...</div>

  <div class="section">
    <div class="section-title">Stablecoin Portfolio</div>
    <div id="stable">Loading...</div>
  </div>

  <div class="section">
    <div class="section-title">Heaven's Vault Portfolio</div>
    <div id="heaven">Loading...</div>
  </div>
</body>
</html>
