<!DOCTYPE html>
<html>
<head>
  <title>ðŸ’¼ Daddy's Real DeFi Vault</title>
  <meta charset=\"UTF-8\">
  <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>
  <script src=\"https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js\"></script>
  <script src=\"https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.min.js\"></script>
  <style>
    body { background: #0d0d0d; color: #00ffcc; font-family: monospace; padding: 20px; }
    h1 { color: #00ffff; }
    .timestamp { font-size: 12px; color: #aaa; margin-bottom: 20px; }
    .section-title { font-size: 16px; font-weight: bold; color: #00ffff; margin: 20px 0 10px; }
    .box { background: #111; padding: 10px; margin-bottom: 10px; border-radius: 4px; border: 1px solid #222; transition: background-color 0.5s ease; }
    .gain { font-weight: bold; color: #00ffcc; }
    .positive { color: #00ff00; }
    .negative { color: #ff4444; }
    .flash-up { background-color: #003300 !important; }
    .flash-down { background-color: #330000 !important; }
    #chartContainer { margin-top: 50px; }
  </style>
</head>
<body>
  <h1>ðŸ’¼ Daddy's Real DeFi Vault</h1>
  <div class=\"timestamp\" id=\"timestamp\">Loading...</div>

  <div class=\"section\">
    <div class=\"section-title\">Stablecoin Portfolio</div>
    <div id=\"stable\">Loading...</div>
  </div>

  <div class=\"section\">
    <div class=\"section-title\">Heaven's Vault Portfolio</div>
    <div id=\"heaven\">Loading...</div>
  </div>

  <div id=\"chartContainer\">
    <div class=\"section-title\">Combined Portfolio Performance</div>
    <canvas id=\"vaultChart\" width=\"600\" height=\"100\"></canvas>
  </div>

  <div class=\"section\">
    <div class=\"section-title\">Stablecoin Performance</div>
    <canvas id=\"stableChart\" width=\"600\" height=\"100\"></canvas>
  </div>

  <div class=\"section\">
    <div class=\"section-title\">Heaven's Vault Performance</div>
    <canvas id=\"heavenChart\" width=\"600\" height=\"100\"></canvas>
  </div>

  <script>
    const START_STABLE = 5000;
    const START_HEAVEN = 5000;

    const stableTokens = {'USDE':'ethena-usde','RAI':'rai','FRAX':'frax','ALUSD':'alchemix-usd','LUSD':'liquity-usd'};
    const heavenTokens = {'ETHENA':'ethena-usde','PENDLE':'pendle','GMX':'gmx','LIT':'litentry','METH':'mantle-staked-ether'};

    let holdings={stable:{},heaven:{}};let performanceHistory=[];let previousPrices={};
    let chart,stableChart,heavenChart;

    function saveHoldings(){localStorage.setItem('daddyVaultHoldings',JSON.stringify({holdings,history:performanceHistory,timestamp:new Date().toISOString()}));}
    function loadHoldings(){const s=localStorage.getItem('daddyVaultHoldings');if(s){const p=JSON.parse(s);holdings=p.holdings||holdings;performanceHistory=p.history||[];}}

    async function fetchPrices(tokens){const ids=[...new Set(Object.values(tokens))].join(',');const res=await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=gbp`);if(!res.ok)throw new Error('Price fetch failed');return await res.json();}

    function initHoldings(tokens,start,prices,store){const per=start/Object.keys(tokens).length;for(const[sym,id]of Object.entries(tokens)){if(!store[sym]){store[sym]={priceBought:prices[id]?.gbp||1,quantity:per/(prices[id]?.gbp||1)}}}}

    function updateBox(id,p){const el=document.getElementById(id);if(!el)return;const prev=previousPrices[id];if(prev!==undefined){el.classList.add(p>prev?'flash-up':'flash-down');setTimeout(()=>el.classList.remove('flash-up','flash-down'),1500);}el.innerHTML=`Â£${p.toFixed(6)}`;previousPrices[id]=p;}

    function renderHoldings(tokens,prices,store,start,prefix){let t=0,h='';for(const[sym,id]of Object.entries(tokens)){const p=prices[id]?.gbp||0,q=store[sym]?.quantity||0,v=q*p;t+=v;const bid=`${prefix}-${sym}`;h+=`<div class=\"box\">${sym} Price<br><div id=\"${bid}\">Â£${p.toFixed(6)}</div></div>`;setTimeout(()=>updateBox(bid,p),0);}const g=t-start,gc=g>=0?'positive':'negative';return`<div class=\"box\">Total Value<br>Â£${t.toFixed(2)}</div>${h}<div class=\"gain ${gc}\">Gain<br>Â£${g.toFixed(2)} (${(g/start*100).toFixed(2)}%)</div>`;}

    async function updateVault(){try{const prices=await fetchPrices({...stableTokens,...heavenTokens});
      if(!Object.keys(holdings.stable).length)initHoldings(stableTokens,START_STABLE,prices,holdings.stable);
      if(!Object.keys(holdings.heaven).length)initHoldings(heavenTokens,START_HEAVEN,prices,holdings.heaven);
      document.getElementById('stable').innerHTML=renderHoldings(stableTokens,prices,holdings.stable,START_STABLE,'stable');
      document.getElementById('heaven').innerHTML=renderHoldings(heavenTokens,prices,holdings.heaven,START_HEAVEN,'heaven');
      saveHoldings();document.getElementById('timestamp').textContent=`Updated: ${new Date().toUTCString()}`;}catch(e){console.error(e);}}

    loadHoldings();updateVault();setInterval(updateVault,30000);
  </script>
</body>
</html>
