<!DOCTYPE html>
<html>
<head>
  <title>üß† Daddy's DeFi Vault</title>
  <meta charset="UTF-8">
  <style>
    body {
      background-color: #0d0d0d;
      color: #00ffcc;
      font-family: monospace;
      padding: 20px;
    }
    .vault {
      border: 1px solid #00ffcc;
      padding: 15px;
      margin-bottom: 30px;
      border-radius: 8px;
      background-color: #111;
    }
    .vault-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #00ffff;
    }
    .gain {
      font-weight: bold;
      margin-top: 10px;
    }
    .gain.positive {
      color: #00ff00;
    }
    .gain.negative {
      color: #ff4444;
    }
  </style>
  <script>
    const START_STABLE = 5000;
    const START_HEAVEN = 5000;

    const stableTokens = {
      'USDE': 'ethena-usde',
      'RAI': 'rai',
      'FRAX': 'frax',
      'ALUSD': 'alchemix-usd',
      'LUSD': 'liquity-usd'
    };

    const heavenTokens = {
      'ETHENA': 'ethena-usde',
      'PENDLE': 'pendle',
      'GMX': 'gmx',
      'LIT': 'litentry',
      'METH': 'mantle-staked-ether'
    };

    async function fetchPrices(tokens) {
      const ids = Object.values(tokens).join(',');
      const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=gbp`);
      return res.json();
    }

    function calculate(tokens, prices, start) {
      const split = start / Object.keys(tokens).length;
      let total = 0;
      const details = [];

      for (const [symbol, id] of Object.entries(tokens)) {
        const price = prices[id]?.gbp ?? 1;
        const qty = split / price;
        const value = qty * price;
        total += value;
        details.push({ symbol, price });
      }

      const gain = total - start;
      const gainPct = (gain / start) * 100;

      return { total, gain, gainPct, details };
    }

    function renderVault(name, data, start) {
      const gainClass = data.gain >= 0 ? 'positive' : 'negative';
      let html = `<div class="vault"><div class="vault-title">${name} Portfolio</div>`;
      html += `Total Value<br><div class="vault">¬£${data.total.toFixed(2)}</div><br>`;
      data.details.forEach(t => {
        html += `${t.symbol} Price<br><div class="vault">¬£${t.price.toFixed(6)}</div><br>`;
      });
      html += `<div class="gain ${gainClass}">${name} Gain<br>¬£${data.gain.toFixed(2)} (${data.gainPct.toFixed(2)}%)</div>`;
      html += `</div>`;
      return html;
    }

    async function update() {
      document.body.innerHTML = '<h1>üß† Daddy\'s Live DeFi Vault</h1><p>Loading...</p>';
      try {
        const stablePrices = await fetchPrices(stableTokens);
        const heavenPrices = await fetchPrices(heavenTokens);

        const stableData = calculate(stableTokens, stablePrices, START_STABLE);
        const heavenData = calculate(heavenTokens, heavenPrices, START_HEAVEN);

        document.body.innerHTML = `
          <h1>üß† Daddy's Live DeFi Vault</h1>
          ${renderVault("Stablecoin", stableData, START_STABLE)}
          ${renderVault("Heaven's Vault", heavenData, START_HEAVEN)}
        `;
      } catch (e) {
        document.body.innerHTML = '<h1>üß† Daddy\'s Live DeFi Vault</h1><p style="color:red;">‚ùå Failed to load data</p>';
        console.error(e);
      }
    }

    setInterval(update, 60000);
    window.onload = update;
  </script>
</head>
<body>
</body>
</html>
