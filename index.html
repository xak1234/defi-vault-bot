<!DOCTYPE html>
<html>
<head>
  <title>🧠 Daddy's DeFi Vault</title>
  <meta charset="UTF-8">
  <style>
    body {
      background: #111;
      color: #0f0;
      font-family: monospace;
      padding: 20px;
    }
    .section {
      margin-bottom: 2rem;
    }
    .gain-positive {
      color: #0f0;
    }
    .gain-negative {
      color: #f00;
    }
  </style>
  <script>
    const START_STABLE = 5000;
    const START_HEAVEN = 5000;

    const stableTokens = {
      'USDE': 'ethena-usde',
      'RAI': 'rai',
      'FRAX': 'frax',
      'ALUSD': 'alchemix-usd',
      'LUSD': 'liquity-usd'
    };

    const heavenTokens = {
      'ETHENA': 'ethena-usde',
      'PENDLE': 'pendle',
      'GMX': 'gmx',
      'LIT': 'litentry',
      'METH': 'mantle-staked-ether'
    };

    async function fetchPrices(tokens) {
      const ids = Object.values(tokens).join(',');
      const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=gbp`);
      return res.json();
    }

    function calculatePortfolio(tokens, prices, startAmount) {
      const perToken = startAmount / Object.keys(tokens).length;
      let total = 0;
      const holdings = [];

      for (const [symbol, id] of Object.entries(tokens)) {
        const price = prices[id]?.gbp ?? 1;
        const qty = perToken / price;
        const value = qty * price;
        total += value;
        holdings.push({ symbol, price, qty, value });
      }

      return { total, holdings };
    }

    function renderVault(title, initial, portfolio) {
      const gain = portfolio.total - initial;
      const gainPercent = (gain / initial) * 100;
      const gainClass = gain >= 0 ? 'gain-positive' : 'gain-negative';

      const tokenList = portfolio.holdings.map(t => {
        return `<li>${t.symbol}: £${t.price.toFixed(4)}</li>`;
      }).join('');

      return `
        <div class="section">
          <h2>💼 ${title}</h2>
          Initial Investment: £${initial.toFixed(2)}<br>
          Current Value: £${portfolio.total.toFixed(2)}<br>
          <span class="${gainClass}">
            Gain/Loss: ${gain >= 0 ? '+' : ''}£${gain.toFixed(2)} (${gainPercent.toFixed(2)}%)
          </span><br><br>
          Token Prices:
          <ul>${tokenList}</ul>
        </div>
      `;
    }

    async function refresh() {
      document.getElementById('output').innerHTML = '⏳ Fetching prices...';
      try {
        const stablePrices = await fetchPrices(stableTokens);
        const heavenPrices = await fetchPrices(heavenTokens);

        const stable = calculatePortfolio(stableTokens, stablePrices, START_STABLE);
        const heaven = calculatePortfolio(heavenTokens, heavenPrices, START_HEAVEN);

        const stableHTML = renderVault('Stablecoin Portfolio', START_STABLE, stable);
        const heavenHTML = renderVault('Heaven\'s Vault Portfolio', START_HEAVEN, heaven);

        document.getElementById('output').innerHTML = stableHTML + heavenHTML;
        document.getElementById('timestamp').textContent = '📅 Last updated: ' + new Date().toLocaleString();
      } catch (err) {
        document.getElementById('output').innerHTML = '❌ Failed to fetch prices.';
        console.error(err);
      }
    }

    setInterval(refresh, 60000);
    window.onload = refresh;
  </script>
</head>
<body>
  <h1>🧠 Daddy's Live DeFi Vault</h1>
  <div id="timestamp">📅 Loading...</div>
  <div id="output">Fetching data...</div>
</body>
</html>
